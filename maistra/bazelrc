# Common build flags
build --cxxopt -w

build --host_force_python=PY3
build --extra_toolchains=@local_jdk//:all
build --tool_java_runtime_version=local_jdk
build --verbose_failures
build --config=clang

# Test flags
build --test_env=ENVOY_IP_TEST_VERSIONS=v4only
build --test_env=HEAPCHECK=minimal
build --test_output=all

# As of today we do not support QUIC/HTTP3, hence we exclude it from the build, always.
# Unfortunately, just setting //bazel:http3=False, is not enough to achieve this.
# Instead, we also have to use boringssl=fips define and filter on the nofips tag.
# This is based on the fact that the FIPS version of BoringSSL doesn't provide enough
# of the functions required to build the QUIC implementation provided by Quiche i.e. if
# we say that we are using the FIPS version of BoringSSL, then all the QUIC support is
# excluded from the build.
common --@envoy//bazel:http3=False
common --define=boringssl=fips
build --build_tag_filters=-nofips
test --test_tag_filters=-nofips

# Arch-specific build flags, triggered with --config=$ARCH in bazel build command
build:x86_64 --linkopt=-fuse-ld=lld
build:s390x --@envoy//source/extensions/filters/common/lua:luajit2=1 --cxxopt='-includeoptional' --copt=-Wno-error=type-limits --copt=-Wno-error=uninitialized --linkopt=-fuse-ld=gold --copt=-fno-builtin-strlen --action_env=BAZEL_LINKLIBS=-lstdc++
build:ppc --linkopt=-fuse-ld=lld --@envoy//source/extensions/filters/common/lua:luajit2=1
build:aarch64 --linkopt=-fuse-ld=lld

# Colored ouput messes with some of the logging systems in CI, so we disable that.
build:ci-config --color=no
build:ci-config --show_progress_rate_limit=10

# Import vendor flags
import %workspace%/maistra/bazelrc-vendor
